{% extends 'base.html' %} {% block title %}- Convidados{% endblock %} {% block
content %}
<section>
  <br /><br />
  <br /><br />
  <br /><br />
  <h1>
    {{estatisticas.total_convidados}} convidados
    <button id="mais_informacoes_convidados_bt">Mais informações</button>
  </h1>
  <div id="mais_informacoes_convidados_div">
    <p>
      Média de convidados por convite:
      {{estatisticas.media_convidados_por_convite}}
    </p>
    <div class="charts">
      <div id="chart_noivos_geral" class="chart"></div>
      <div id="chart_categorias_geral" class="chart"></div>
    </div>
    <div class="charts">
      {% for nome, dados in estatisticas.noivos.items() %}
      <div>
        <h2>{{nome}}</h2>
        <div id="noivo_{{dados.id}}_chart" class="chart"></div>
      </div>
      {% endfor %}
    </div>
  </div>
  <table id="convidados" class="display">
    <thead>
      <tr>
        <th>Nome</th>
        <th>N</th>
        <th>Noivo</th>
        <th>Categoria</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody>
      {% for convidado in convidados %}
      <tr>
        <td>{{convidado.nome}}</td>
        <td>{{convidado.numero_convidados}}</td>
        <td>{{convidado.noivo.nome}}</td>
        <td>{{convidado.categoria.nome}}</td>
        <td class="acoes">
          <div><button class="copiar_convite">Copiar</button></div>
          <div><button class="teste_alerta">Alertar</button></div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  <script>
    window.onload = function () {
        var generalOptions = {
            type: "doughnut",
            startAngle: 60,
            innerRadius: 90,
            indexLabelFontSize: 12,
            indexLabel: "{label} - #percent%",
            toolTipContent: "<b>{label}:</b> {y} (#percent%)",
        }

        var noivosGeralChart = new CanvasJS.Chart("chart_noivos_geral", {
            data: [{
                ...generalOptions,
                showInLegend: true,
                    dataPoints: [
                    {% for nome, dados in estatisticas.noivos.items() %}
                        { y: parseInt('{{dados.total}}'), label: "{{nome}}", name: "{{nome}}" },
                    {% endfor %}
                    ],
                }],
        });

        var categoriaGeralChart = new CanvasJS.Chart("chart_categorias_geral", {
            data: [{
                    ...generalOptions,
                    dataPoints: [
                    {% for nome, numero in estatisticas.categorias.items() %}
                        { y: parseInt('{{numero}}'), label: "{{nome}}" },
                    {% endfor %}
                    ],
                }],
        });

        var noivoCharts = []
        {% for nome, dados in estatisticas.noivos.items() %}
        noivoCharts.push(new CanvasJS.Chart("noivo_{{dados.id}}_chart", {
            data: [{
                    ...generalOptions,
                    dataPoints: [
                    {% for nome, numero in dados.categorias.items() %}
                        { y: parseInt('{{numero}}'), label: "{{nome}}" },
                    {% endfor %}
                    ],
                }],
        }))
        {% endfor %}

    categoriaGeralChart.render();
    noivosGeralChart.render();
    noivoCharts.forEach(function(noivoChart){
        noivoChart.render()
    })
    }
  </script>
</section>
{% endblock %}
